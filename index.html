<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØºØ±ÙØ© Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #e5ddd5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #header { background: #075e54; color: white; padding: 15px; text-align: center; font-size: 1.2rem; }
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 75%; padding: 10px; border-radius: 10px; font-size: 15px; word-wrap: break-word; }
        .sent { align-self: flex-end; background: #dcf8c6; }
        .received { align-self: flex-start; background: #ffffff; }
        img { max-width: 100%; border-radius: 8px; margin-top: 5px; cursor: pointer; display: block; }
        #input-area { background: #f0f0f0; padding: 12px; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px; border: none; border-radius: 25px; outline: none; }
        button { background: #075e54; color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #075e54; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
    </style>
</head>
<body>

<div id="lock-screen" class="overlay">
    <h2>ØºØ±ÙØ© Ø®Ø§ØµØ©</h2>
    <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button onclick="checkPass()" style="width: 80px; border-radius: 5px; margin-top: 10px;">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="header">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Ø¯Ø¹Ù… Ø§Ù„Ù„ØµÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±) ğŸŸ¢</div>
<div id="chat-window"></div>
<div id="input-area">
    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ Ø§Ù„ØµÙ‚ ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© (Ctrl+V)...">
    <button onclick="send()">></button>
</div>

<script>
    const MY_PASSWORD = "1234"; 
    function checkPass() { if (document.getElementById('passInput').value === MY_PASSWORD) document.getElementById('lock-screen').style.display = 'none'; else alert("Ø®Ø·Ø£!"); }

    const firebaseConfig = {
        apiKey: "AIzaSyBwQ4FDlDR1bzDIHIx5Mhh92shCXrQk7xg",
        authDomain: "mychat-fb8a2.firebaseapp.com",
        projectId: "mychat-fb8a2",
        storageBucket: "mychat-fb8a2.firebasestorage.app",
        messagingSenderId: "915743488728",
        appId: "1:915743488728:web:40763dcd769e2ace9f5ad"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const urlParams = new URLSearchParams(window.location.search);
    const currentUser = urlParams.get('u') || "A";

    function send(content = null) {
        const text = content || document.getElementById('msgInput').value;
        if(text.trim()){
            db.collection("messages").add({
                text: text,
                user: currentUser,
                time: firebase.firestore.FieldValue.serverTimestamp()
            });
            if(!content) document.getElementById('msgInput').value = "";
        }
    }

    // Ù…ÙŠØ²Ø© Ø§Ù„Ù„ØµÙ‚ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ØµÙˆØ±
    document.getElementById('msgInput').addEventListener('paste', function(e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let index in items) {
            const item = items[index];
            if (item.kind === 'file' && item.type.includes('image')) {
                const blob = item.getAsFile();
                const reader = new FileReader();
                reader.onload = function(event) {
                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ§Ù†Ø§Øª Base64 (Ø³ØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø±ÙØ¹Ù‡Ø§ Ø®Ø§Ø±Ø¬ÙŠØ§Ù‹)
                    send(event.target.result);
                };
                reader.readAsDataURL(blob);
            }
        }
    });

    db.collection("messages").orderBy("time").onSnapshot(snapshot => {
        const win = document.getElementById('chat-window');
        win.innerHTML = "";
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = `msg ${data.user === currentUser ? 'sent' : 'received'}`;
            if (data.text.startsWith('data:image') || data.text.match(/\.(jpeg|jpg|gif|png|webp)$/)) {
                div.innerHTML = `<img src="${data.text}" onclick="window.open('${data.text}')">`;
            } else {
                div.innerText = data.text;
            }
            win.appendChild(div);
        });
        win.scrollTop = win.scrollHeight;
    });

    document.getElementById("msgInput").addEventListener("keyup", (e) => { if (e.key === "Enter") send(); });
</script>
</body>
</html>
